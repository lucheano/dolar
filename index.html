<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitor de CEDEARs</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
  table { border-collapse: collapse; width: 100%; font-size: 14px; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #333; color: #fff; }
  .arbitrado { background-color: #d4edda; } /* verde */
  .no-arbitrado { background-color: #f8d7da; } /* rojo */
</style>
</head>
<body>

<h1>Monitor de CEDEARs y Arbitraje</h1>

<table>
  <thead>
    <tr>
      <th>Símbolo</th>
      <th>Precio CEDEAR $</th>
      <th>Precio acción US$</th>
      <th>Ratio</th>
      <th>Tipo cambio implícito</th>
      <th>Dólar CCL</th>
      <th>Arbitrado?</th>
      <th>Var. Pesos %</th>
      <th>Var. USD %</th>
    </tr>
  </thead>
  <tbody id="cedearTable"></tbody>
</table>

<script>
// Configuración inicial
const dolarCCL = 335; // valor actual del CCL (se puede conectar a API real)
const ratios = {
    "AAL": 5, "AAPL": 10, "ABBV": 20 
    // ⚠️ acá hay que cargar todos los ratios de cada CEDEAR
};
const preciosAccionUSD = {
    "AAL": 27, "AAPL": 225, "ABBV": 150
    // ⚠️ estos precios deberían venir de Yahoo Finance o una API de USA
};

async function loadCedears() {
    try {
        const res = await fetch("https://data912.com/live/arg_cedears");
        const data = await res.json();

        const tbody = document.getElementById("cedearTable");
        tbody.innerHTML = "";

        data.forEach(cedear => {
            const symbol = cedear.symbol;
            const precioPesos = cedear.c;
            const ratio = ratios[symbol] || 1;
            const precioUSD = preciosAccionUSD[symbol] || 1;

            // Calcular tipo de cambio implícito
            const tipoCambioImpl = (precioPesos * ratio) / precioUSD;
            const arbitrado = tipoCambioImpl > dolarCCL ? "Sí" : "No";

            // Variación en pesos (viene del JSON directo)
            const variacionPesos = cedear.pct_change;

            // Variación en USD (aprox, a partir del precio de referencia)
            let variacionUSD = 0;
            if (precioUSD > 0) {
                const precioUSD_anterior = precioUSD / (1 + variacionPesos/100);
                variacionUSD = ((precioUSD - precioUSD_anterior) / precioUSD_anterior) * 100;
            }

            // Agregar fila
            const row = document.createElement("tr");
            row.className = arbitrado === "Sí" ? "arbitrado" : "no-arbitrado";
            row.innerHTML = `
                <td>${symbol}</td>
                <td>${precioPesos.toFixed(2)}</td>
                <td>${precioUSD.toFixed(2)}</td>
                <td>${ratio}</td>
                <td>${tipoCambioImpl.toFixed(2)}</td>
                <td>${dolarCCL}</td>
                <td>${arbitrado}</td>
                <td>${variacionPesos.toFixed(2)}%</td>
                <td>${variacionUSD.toFixed(2)}%</td>
            `;
            tbody.appendChild(row);
        });

    } catch (err) {
        console.error("Error cargando JSON:", err);
    }
}

// Cargar al iniciar y actualizar cada 30 segundos
loadCedears();
setInterval(loadCedears, 30000);
</script>

</body>
</html>
