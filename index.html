<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Monitor de CEDEARs</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #333; color: #fff; }
    tr:nth-child(even) { background-color: #f4f4f4; }
    .positivo { color: green; font-weight: bold; }
    .negativo { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>Monitor de CEDEARs y Arbitraje</h1>
<p>Datos actualizados desde <strong>dolarapi.com</strong> y <strong>data912.com</strong></p>

<table>
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Tipo de Cambio (CCL_mark)</th>
      <th>Cambio CCL %</th>
      <th>Spread vs CCL Venta</th>
      <th>Volumen ARS</th>
      <th>Arbitrado</th>
    </tr>
  </thead>
  <tbody id="cedearTable"></tbody>
</table>

<script>
async function loadCedears() {
  try {
    // Obtener CCL (venta)
    const dolarRes = await fetch("https://dolarapi.com/v1/dolares");
    const dolarData = await dolarRes.json();
    const cclVenta = dolarData.find(d => d.casa === "contadoconliqui").venta;

    // Obtener CEDEARs desde data912 (pasando por proxy allorigins)
    const res = await fetch("https://data912.com/live/arg_cedears");
    const data = await res.json();

    const tbody = document.getElementById("cedearTable");
    tbody.innerHTML = "";

    data.forEach(cedear => {
      const ticker = cedear.ticker_ar || cedear.ticker_usa || "-";
      const cclMark = Number(cedear.CCL_mark) || 0;
      const cclClose = Number(cedear.CCL_close) || 0;
      const volumen = Number(cedear.ars_volume) || 0;

      // Cambio % entre CCL actual y cierre
      const cambioCCL = cclClose ? ((cclMark - cclClose) / cclClose) * 100 : 0;

      // Spread vs CCL venta
      const spread = cclVenta ? ((cclMark - cclVenta) / cclVenta) * 100 : 0;

      // Arbitrado: dentro de ±1%
      const arbitrado = Math.abs(spread) <= 1;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${ticker}</td>
        <td>${cclMark.toFixed(2)}</td>
        <td class="${cambioCCL >= 0 ? "positivo" : "negativo"}">
          ${cambioCCL >= 0 ? "▲" : "▼"} ${cambioCCL.toFixed(2)}%
        </td>
        <td class="${spread >= 0 ? "positivo" : "negativo"}">${spread.toFixed(2)}%</td>
        <td>${volumen.toLocaleString()}</td>
        <td>${arbitrado ? "Sí" : "No"}</td>
      `;
      tbody.appendChild(row);
    });

    console.log("CCL Venta:", cclVenta);
  } catch (error) {
    console.error("Error al cargar datos:", error);
  }
}

// Ejecutar al inicio y refrescar cada 60 segundos
loadCedears();
setInterval(loadCedears, 60000);
</script>

</body>
</html>
