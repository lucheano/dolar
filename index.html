<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Monitor de CEDEARs</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #333; color: #fff; }
    tr:nth-child(even) { background-color: #f4f4f4; }
    .positivo { color: green; font-weight: bold; }
    .negativo { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>Monitor de CEDEARs y Arbitraje</h1>
<p>Datos actualizados automáticamente desde <strong>dolarapi.com</strong> y <strong>data912.com</strong></p>

<table>
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Precio ARS</th>
      <th>Cambio ARS</th>
      <th>Tipo de Cambio Implícito</th>
      <th>Spread vs CCL</th>
      <th>Volumen</th>
      <th>Arbitrado</th>
    </tr>
  </thead>
  <tbody id="cedearTable"></tbody>
</table>

<script>
async function loadCedears() {
  try {
    // Obtener CCL (venta)
    const dolarRes = await fetch("https://dolarapi.com/v1/dolares");
    const dolarData = await dolarRes.json();
    const cclVenta = dolarData.find(d => d.casa === "contadoconliqui").venta;

    // Obtener CEDEARs desde data912
    const res = await fetch("https://api.allorigins.win/raw?url=https://data912.com/live/arg_cedears");
    const data = await res.json();

    const tbody = document.getElementById("cedearTable");
    tbody.innerHTML = "";

    data.forEach(item => {
      const ticker = item.ticker_ar;
      const cclMark = Number(item.CCL_mark);
      const cclClose = Number(item.CCL_close);
      const cambioARS = cclClose ? ((cclMark - cclClose) / cclClose) * 100 : 0;
      const spread = cclVenta ? ((cclMark - cclVenta) / cclVenta) * 100 : 0;
      const volumen = item.ars_volume || 0;
      const arbitrado = Math.abs(spread) < 1; // ±1% margen

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${ticker}</td>
        <td>${cclMark.toFixed(2)}</td>
        <td class="${cambioARS >= 0 ? "positivo" : "negativo"}">
          ${cambioARS >= 0 ? "▲" : "▼"} ${cambioARS.toFixed(2)}%
        </td>
        <td>${cclMark.toFixed(2)}</td>
        <td class="${spread >= 0 ? "positivo" : "negativo"}">${spread.toFixed(2)}%</td>
        <td>${volumen.toLocaleString()}</td>
        <td>${arbitrado ? "Sí" : "No"}</td>
      `;
      tbody.appendChild(row);
    });

    console.log("CCL Venta:", cclVenta);

  } catch (error) {
    console.error("Error al cargar datos:", error);
  }
}

// Ejecutar al inicio y refrescar cada 1 minuto
loadCedears();
setInterval(loadCedears, 60000);
</script>

</body>
</html>
