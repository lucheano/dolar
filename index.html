<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Monitor de CEDEARs</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #333; color: #fff; }
    tr:nth-child(even) { background-color: #f4f4f4; }
    .positivo { color: green; font-weight: bold; }
    .negativo { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>Monitor de CEDEARs y Arbitraje</h1>
<p>Datos actualizados desde <strong>data912.com</strong>, <strong>dolarapi.com</strong> y <strong>Yahoo Finance</strong></p>

<table>
  <thead>
    <tr>
      <th>Símbolo</th>
      <th>Precio CEDEAR $</th>
      <th>Precio acción US$</th>
      <th>Teórico ARS</th>
      <th>Spread %</th>
      <th>Cambio ARS</th>
      <th>Cambio USD</th>
    </tr>
  </thead>
  <tbody id="cedearTable"></tbody>
</table>

<script>
async function getYahooPrice(symbol) {
  try {
    const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`;
    const res = await fetch(url);
    const data = await res.json();
    const quote = data.quoteResponse.result[0];
    return {
      price: quote.regularMarketPrice,
      prevClose: quote.regularMarketPreviousClose
    };
  } catch {
    return { price: 0, prevClose: 0 };
  }
}

async function loadCedears() {
  try {
    // Obtener CCL venta
    const dolarRes = await fetch("https://dolarapi.com/v1/dolares");
    const dolarData = await dolarRes.json();
    const ccl = dolarData.find(d => d.casa === "contadoconliqui").venta;

    // Obtener CEDEARs
    const res = await fetch("https://data912.com/live/arg_cedears");
    const data = await res.json();

    const tbody = document.getElementById("cedearTable");
    tbody.innerHTML = "";

    for (const cedear of data) {
      const symbol = cedear.symbol;
      const precioARS = cedear.c;
      const cambioARS = cedear.pct_change;

      // Obtener precio USD desde Yahoo Finance
      const usdData = await getYahooPrice(symbol);
      const precioUSD = usdData.price;
      const prevUSD = usdData.prevClose;

      // Calcular cambio USD
      const cambioUSD = prevUSD > 0 ? ((precioUSD - prevUSD) / prevUSD) * 100 : 0;

      // Calcular teórico (precioUSD * CCL)
      const teoricoARS = precioUSD * ccl;

      // Spread entre real y teórico
      const spread = ((precioARS - teoricoARS) / teoricoARS) * 100;

      // Flechas de cambio
      const flechaARS = cambioARS > 0 ? "▲" : cambioARS < 0 ? "▼" : "";
      const flechaUSD = cambioUSD > 0 ? "▲" : cambioUSD < 0 ? "▼" : "";

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${symbol}</td>
        <td>${precioARS.toFixed(2)}</td>
        <td>${precioUSD > 0 ? precioUSD.toFixed(2) : "-"}</td>
        <td>${teoricoARS.toFixed(2)}</td>
        <td class="${spread >= 0 ? "positivo" : "negativo"}">${spread.toFixed(2)}%</td>
        <td class="${cambioARS >= 0 ? "positivo" : "negativo"}">${flechaARS} ${cambioARS.toFixed(2)}%</td>
        <td class="${cambioUSD >= 0 ? "positivo" : "negativo"}">${flechaUSD} ${cambioUSD.toFixed(2)}%</td>
      `;
      tbody.appendChild(row);
    }
  } catch (err) {
    console.error("Error cargando datos:", err);
  }
}

// Ejecutar al iniciar y refrescar cada minuto
loadCedears();
setInterval(loadCedears, 60000);
</script>

</body>
</html>
