<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>CEDEARs — CCL y Arbitraje</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --ok:#0a7d11; --bad:#c5162b; --muted:#777; }
  body { font-family: Arial, sans-serif; background:#f6f7f9; margin:0; padding:24px; }
  h1 { margin:0 0 10px 0; font-size:20px; }
  .meta { color:#555; font-size:13px; margin-bottom:14px; }
  table { width:100%; border-collapse: collapse; background:#fff; border-radius:12px; overflow:hidden; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
  th, td { padding:10px 8px; border-bottom:1px solid #eee; text-align:center; }
  th { background:#111827; color:#fff; position: sticky; top:0; z-index:1; }
  tr:nth-child(even) td { background:#fbfbfd; }
  .pos { color: var(--ok); font-weight: 600; }
  .neg { color: var(--bad); font-weight: 600; }
  .muted { color: var(--muted); }
  .left { text-align:left; }
</style>
</head>
<body>

<h1>CEDEARs — CCL y Arbitraje</h1>
<div class="meta">Datos: <strong>data912.com</strong> + <strong>dolarapi.com</strong>. Actualización cada 60s.</div>

<table id="tablaCedears">
  <thead>
    <tr>
      <th class="left">Ticker AR</th>
      <th class="left">Ticker USA</th>
      <th>CCL implícito</th>
      <th>Spread vs CCL venta</th>
      <th>Cambio CCL implícito</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function robustJSON(url) {
  const r = await fetch(url);
  const txt = await r.text();
  let parsed;
  try { parsed = JSON.parse(txt); }
  catch(e){ console.error("Error parseando JSON:", e, txt.slice(0,100)); return null; }
  if (Array.isArray(parsed)) return parsed;
  if (parsed && Array.isArray(parsed.data)) return parsed.data;
  return null;
}

async function fetchCCLVenta() {
  const data = await robustJSON("https://dolarapi.com/v1/dolares");
  if (!data) return null;
  const ccl = data.find(x => x.casa === "contadoconliqui");
  return ccl ? Number(ccl.venta) : null;
}

async function fetchCedears() {
  return await robustJSON("https://data912.com/live/arg_cedears");
}

function flecha(valor) {
  if (valor > 0) return "▲";
  if (valor < 0) return "▼";
  return "";
}

function colorClase(valor) {
  if (valor > 0) return "pos";
  if (valor < 0) return "neg";
  return "muted";
}

async function actualizar() {
  try {
    const [cedears, cclVenta] = await Promise.all([fetchCedears(), fetchCCLVenta()]);
    const tbody = document.querySelector("#tablaCedears tbody");
    tbody.innerHTML = "";

    if (!cedears || cedears.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5">No se recibieron datos.</td></tr>`;
      return;
    }

    cedears.forEach(c => {
      const tickerAR = c.ticker_ar || "-";
      const tickerUSA = c.ticker_usa || "-";
      const cclMark = Number(c.CCL_mark) || 0;
      const cclClose = Number(c.CCL_close) || 0;
      const spread = cclVenta ? ((cclMark - cclVenta) / cclVenta) * 100 : null;
      const cambioCCL = (cclMark && cclClose) ? ((cclMark - cclClose) / cclClose) * 100 : null;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="left">${tickerAR}</td>
        <td class="left">${tickerUSA}</td>
        <td>${cclMark.toFixed(2)}</td>
        <td class="${colorClase(spread)}">${spread ? spread.toFixed(2) + "%" : "-"}</td>
        <td class="${colorClase(cambioCCL)}">${flecha(cambioCCL)} ${cambioCCL ? cambioCCL.toFixed(2) + "%" : "-"}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error("Error cargando datos:", err);
  }
}

actualizar();
setInterval(actualizar, 60000);
</script>

</body>
</html>
